---
title: "Final"
author: "Sara Gonzalez"
date: June 16, 2023
format:
  html:
    toc: true
    toc-location: left
    code-fold: true
execute:
  message: false
  warning: false
---

# Problem 1

## Introduction

Disturbance is a major factor determining the plant community structure of ecological systems. Kangaroo rat (*Dipodomys spectabilis*) mounds are small-scale disturbances that support unique plant communities compared to surrounding habitats. These disturbances can affect the seed bank, an overlooked part of plant communities and an important trait of some plant species that allows for their persistence in unpredictable environments (Koontz & Simpson, 2013). Many might care about these seed bank disturbances because *D. spectabilis* manages the structure of microbial communities (Herrera et al., 2001). These microbes have the ability to recycle the primary elements that make up all living systems, especially carbon, nitrogen, and oxygen, three elements that are vital to not only plant communities, but also to animals and humans (Gupta et al., 2016). It could be useful to find how total seed number differs between kangaroo rat mound locations because it could demonstrate a relationship that tells us more about how a plant community is doing in a certain rat mound location as well as whether it is doing better or worse than other plant communities in other rat mound locations. The question I am trying to answer is: How does total seed number differ between kangaroo rat mound locations? The null hypothesis is that total seed number doesn't differ between kangaroo rat mound locations. The alternative hypothesis states the opposite, that total seed number does differ between kangaroo rat mound locations.

## Methods

### Set-up: Loading Needed Packages

```{r load-packages}
library(MASS) # have to read this in before tidyverse 
library(lme4)
library(glmmTMB) # ok if you don't have this - just comment it out

# diagnostics and model info
library(DHARMa)
library(MuMIn)
library(ggeffects)
library(lmtest) 
library(broom)
# other packages
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar) 
library(flextable) 
library(car)
library(broom)
library(dplyr)
library(corrplot)
library(AICcmodavg)
library(GGally)
```

### Data Collection + Organization

```{r read-in-data}
 # data was originally a txt file. wouldn't convert to csv properly
inUrl1  <- "https://pasta.lternet.edu/package/data/eml/knb-lter-sev/208/102459/a063411c03e4baef6707862466685442" 
infile1 <- tempfile()
try(download.file(inUrl1,infile1,method="curl"))
if (is.na(file.size(infile1))) download.file(inUrl1,infile1,method="auto")
 seeds <-read.csv(infile1,header=F 
          ,skip=1
            ,sep=","  
        , col.names=c(
                    "mnd",     
                    "dir",     
                    "loc",     
                    "species",     
                    "seeds"    ), check.names=TRUE) %>% 
   select(loc, seeds) # select columns of interest
```

### Missing Data

```{r missing-data-visualization}
gg_miss_var(seeds) +
  theme_classic() +
  labs(caption = "There are no missing data observations for rat mound locations and seed count.")
```

## Results 

## References

Gupta, A., Gupta, R., & Singh, R. L. (2016). Microbes and environment. *Principles and Applications of Environmental Biotechnology for a Sustainable Future*, 43--84. <https://doi.org/10.1007/978-981-10-1866-4_3>

Herrera, J., Ensz, K. L., & Wilke, A. L. (2001). Stacking of seeds changes spoilage dynamics of food caches of the banner-tailed kangaroo rat (Dipodomys spectabilis). *Journal of Mammalogy*, *82*(2), 558--566. <https://doi.org/10.1093/jmammal/82.2.558>

Koontz, T. L., & Simpson, H. L. (2010). The composition of seed banks on kangaroo rat (Dipodomys spectabilis) mounds in a chihuahuan desert grassland. *Journal of Arid Environments*, *74*(10), 1156--1161. <https://doi.org/10.1016/j.jaridenv.2010.03.008>

# Problem 2

## Introduction

Climate-change induced alterations in environmental conditions in the alpine tundra has led to "shrubification," the expansion of woody shrubs. Shrubification is thought to change microclimatic conditions that could lead to changes in plant community composition, including seed count and weight (Seaver, 2022). Both of these factors, especially seed weight, are significant because seed weight is generally assumed to be an ecologically important life history trait in plants because it influences both dispersal ability and seedling establishment (Gross & Kromer, 1986). Additionally, seed count can be a way to determine fitness and reproductive success (Zimmerman, 1980). It could be useful to find how certain characteristics vary seed count because they could impact reproductive success in plant communities. If certain factors make reproductive success decline, it could bring harm to impacted plant communities especially those containing endangered species. The questions I am trying to answer are how seed count varies with plot type (shrub or open), plant species, and total number of inflorescences as well as what is the simplest model that explains seed count. The hypothesis being tested is that seed count does not vary with plot type.

## Methods

### Set-up: Loading Needed Packages

```{r loading-packages}
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar) 
library(flextable) 
library(car)
library(broom)
library(dplyr)
library(corrplot)
library(AICcmodavg)
library(GGally)
```

### Data Collection + Organization

```{r read-data}
seedcount <- read_csv(here("data", "knb-lter-nwt", "shrubstudy_seed_ctwt.ms.data.csv")) %>% 
  clean_names() %>% # to make column names cleaner
  select(treatment, species, total_nr_infl, nr_seeds) # selecting columns of interest
```

The sampling methods involved collecting seeds from 5 different species. Seed pods were only collected when they were deemed \"mature\" - meaning they were brown and the seeds were ready to pop out. Seeds were put in a coin envelope that was taped at the corners to ensure that no seeds were lost. Envelopes were marked with the species, toothpick color, shrub number, plot number, number of inflorescences collected, and date of collection, then kept in the refrigerator until the seeds were ready to be counted. The data was organized by cleaning the names and selecting 4 columns of interest: treatment (plot type - shrub or open), species, total_nr_infl (total number of inflorescences), and nr_seeds (seed count).

### Missing Data

```{r missing-data-visual}
gg_miss_var(seedcount) +
  labs(caption = "There are no missing values for treatment, species, and total inflorescences, but a significant number for seed count.") +
  theme_classic()
```

```{r drop-NA-subset}
seedcount_subset <- seedcount %>% 
  drop_na(nr_seeds) # get rid of NA values
```

There is no missing data for the variables species, total number of inflorescences, and treatment (plot type - shrub or open). There are a considerable amount of missing observations in the variable regarding the total number of seeds.

### Variable Relationships

```{r correlation-plot}
seedcount_cor <- seedcount_subset %>%
  select(total_nr_infl, nr_seeds) %>% 
  cor(method = "pearson")
corrplot(seedcount_cor,
         # change shape of what's in the cells
         method = "ellipse",
         addCoef.col = "black",
         mar=c(1,1,3,1))
title(main = "Correlation Plot",
         sub = "The numerical variables have a strong correlation with one another.")
```

```{r pairs-plot}
seedcount_pairs <- seedcount_subset %>% 
  select(treatment:nr_seeds)
ggpairs(seedcount_pairs) + # creates pairs plot
  labs(title = "Relationships Between Variables", caption = "There is some sort of relationship that all the variables have with each other.")
```

### Models

```{r models}
# linear model, we know this is wrong, not continuous variable (discrete)
scmod1 <- lm(nr_seeds ~ treatment + species + total_nr_infl, data = seedcount_subset)

# generalized linear model with Poisson distribution; assumption : variance = mean
scmod2 <- glm(nr_seeds ~ treatment + species + total_nr_infl, data = seedcount_subset, family = "poisson")

# generalized linear model with negative binomial distribution; glm.nb assumes nb dist.; appropriate for over dispersion, variance > mean
scmod3 <- glm.nb(nr_seeds ~ treatment + species + total_nr_infl, data = seedcount_subset)
```

```{r model-residuals}
#| fig.height: 6
#| fig.width: 8
#| fig.align: center

# check diagnostics, use darma b/c GLM don't follow same assumptions, simulation of residuals
simulateResiduals(scmod1, plot = TRUE)
simulateResiduals(scmod2, plot = TRUE) # look better but significant deviation, residuals are over-dispersed
simulateResiduals(scmod3, plot = TRUE)
```

```{r choosing-model}
MuMIn::model.sel(scmod1, scmod2, scmod3) # 100% chance of best model = 1 (weight)
```

```{r summaries}
# model object
scmod3

# summary (z value = test stat based on z dist.)
summary(scmod3)
  # cover is potentially not significant, sppDM, sppEC-L as well keeping everything else constant
# confidence intervals
confint(scmod3)

# adjusted R2
r.squaredGLMM(scmod3) # only look at delta, amount of variance = 43%
# fairly low due to 3 different predictors
```

```{r visualization}
#| fig.width: 12
#| fig.height: 10
#| out.width: 90%
#| fig.align: center

plot(ggpredict(scmod3, terms = c("treatment", "total_nr_infl")), add.data = TRUE)

plot(ggpredict(scmod3, terms = c("treatment", "total_nr_infl", "species")), add.data = TRUE)+
  theme_classic()
# cover has no significant effect on salamander count, but mined status and species do
```

## Results

## References

Gross, K. L., & Kromer, M. L. (1986). Seed Weight Effects on Growth and Reproduction in Oenothera biennis L. *Bulletin of the Torrey Botanical Club*, *113*(3), 252--258. <https://doi.org/10.2307/2996364>

Seaver, M. 2022. Individual and community flowering phenology, seed counts and pollinator visitation rates in shrub and open plots across Niwot Ridge, 2019 - 2021. ver 1. Environmental Data Initiative. <https://doi.org/10.6073/pasta/edc4ab2faf7dd96cd1deac1544d5f2b9>

Zimmerman, M. (1980). Reproduction in polemonium: Pre-dispersal seed predation. *Ecology*, *61*(3), 502--506. <https://doi.org/10.2307/1937415> 
